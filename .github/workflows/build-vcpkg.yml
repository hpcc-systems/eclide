name: Test Build

on:
  workflow_dispatch:
    inputs:
      os:
        type: choice
        options:
          - 'windows-2022'
          - 'windows-2019'
        description: 'Operating System'
        required: false
        default: 'windows-2022'
      architecture:
        type: choice
        options:
          - 'Win32'
          - 'x64'
        description: 'Build Architecture'
        required: false
        default: 'x64'

  # Do not include "push" in final version (uncomment for testing on users own repo)
  # push:

  pull_request:
    branches:
      - "master"
      - "candidate-*"
      - "!candidate-7.10.*"
      - "!candidate-7.8.*"
      - "!candidate-7.6.*"
      - "!candidate-7.4.*"
      - "!candidate-7.2.*"
      - "!candidate-7.0.*"
      - "!candidate-6.*"

  schedule:
    - cron: "0 0 * * *"

jobs:

  build-workflow-dispatch:
    if: ${{ contains('workflow_dispatch', github.event_name) }}
    uses: ./.github/workflows/build-gh_runner.yml
    with:
      os: ${{ inputs.os }}
      architecture: ${{ inputs.architecture }}
    secrets: inherit

  build-gh_runner-windows-2022-x64:
    if: ${{ contains('pull_request,push', github.event_name) }}
    uses: ./.github/workflows/build-gh_runner.yml
    with:
      os: windows-2022
      architecture: x64
    secrets: inherit

  build-gh_runner-windows-2022-Win32:
    if: ${{ contains('pull_request,push', github.event_name) }}
    uses: ./.github/workflows/build-gh_runner.yml
    with:
      os: windows-2022
      architecture: Win32
    secrets: inherit

  build-gh_runner-windows-2019-x64:
    if: ${{ contains('schedule,push', github.event_name) }}
    uses: ./.github/workflows/build-gh_runner.yml
    with:
      os: windows-2019
      architecture: x64
    secrets: inherit

  build-gh_runner-windows-2019-Win32:
    if: ${{ contains('schedule,push', github.event_name) }}
    uses: ./.github/workflows/build-gh_runner.yml
    with:
      os: windows-2019
      architecture: Win32
    secrets: inherit
